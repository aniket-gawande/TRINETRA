# Waypoint System Architecture & Data Flow ğŸ—ï¸

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FRONTEND (React + Vite)                  â”‚
â”‚                     http://localhost:5173                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  MapView.jsx â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Planner.jsx    â”‚                 â”‚
â”‚  â”‚  (Markers)   â”‚         â”‚  (State Mgmt)   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                         â”‚                            â”‚
â”‚         â”‚ onAdd(latlng)           â”‚ api.post()                â”‚
â”‚         â”‚                         â”‚ api.get()                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                      â”‚                                         â”‚
â”‚                      â–¼                                         â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚             â”‚   api.js        â”‚                               â”‚
â”‚             â”‚ (Interceptor +  â”‚                               â”‚
â”‚             â”‚  Auth Token)    â”‚                               â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                      â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTP/HTTPS
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      â–¼                                           â”‚
â”‚        BACKEND (Node.js + Express)                             â”‚
â”‚        http://localhost:5000                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /api/waypoints Routes                                 â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  POST   /waypoints  â”€â”€â”€â”€â–º auth middleware             â”‚    â”‚
â”‚  â”‚                           â†“                           â”‚    â”‚
â”‚  â”‚                    addWaypoint controller             â”‚    â”‚
â”‚  â”‚                           â†“                           â”‚    â”‚
â”‚  â”‚                    Save to MongoDB                    â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  GET    /waypoints  â”€â”€â”€â”€â–º getWaypoints controller    â”‚    â”‚
â”‚  â”‚                           â†“                           â”‚    â”‚
â”‚  â”‚                    Query from MongoDB                 â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  GET    /waypoints/debug/count                        â”‚    â”‚
â”‚  â”‚                    â†“                                   â”‚    â”‚
â”‚  â”‚                    countWaypoints controller          â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  DELETE /waypoints  â”€â”€â”€â”€â–º auth middleware             â”‚    â”‚
â”‚  â”‚                           â†“                           â”‚    â”‚
â”‚  â”‚                    clearWaypoints controller          â”‚    â”‚
â”‚  â”‚                           â†“                           â”‚    â”‚
â”‚  â”‚                    Delete from MongoDB                â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Mongoose ORM
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       â–¼                                          â”‚
â”‚          DATABASE (MongoDB)                                     â”‚
â”‚          mongodb://127.0.0.1:27017/trinetra                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Collection: waypoints                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  {                                                     â”‚   â”‚
â”‚  â”‚    _id: ObjectId("..."),                              â”‚   â”‚
â”‚  â”‚    lat: 18.6517,                                      â”‚   â”‚
â”‚  â”‚    lng: 73.7615,                                      â”‚   â”‚
â”‚  â”‚    order: 1,                                          â”‚   â”‚
â”‚  â”‚    createdAt: Date("2026-01-25T10:30:00Z")           â”‚   â”‚
â”‚  â”‚  }                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Sequence

### 1. User Clicks Map (Add Waypoint)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks â”‚
â”‚ on map      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MapView.onAdd(latlng)   â”‚ â† Receives lat/lng coordinates
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planner.handleAddWaypoint()  â”‚ â† Validation & state update
â”‚ - Check user logged in       â”‚
â”‚ - Validate coordinates       â”‚
â”‚ - Set isSaving = true        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ api.post("/waypoints", data) â”‚ â† API call
â”‚ - Interceptor adds token     â”‚
â”‚ - Sends auth header          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ HTTP POST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: POST /waypoints     â”‚
â”‚ - Auth middleware checks     â”‚
â”‚ - Controller validates data  â”‚
â”‚ - Waypoint.save()            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: Insert Document     â”‚
â”‚ Returns: _id & saved object  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ HTTP Response 201
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: Receive Response   â”‚
â”‚ - Update state.waypoints     â”‚
â”‚ - Show status message âœ…     â”‚
â”‚ - Re-render map with marker  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Page Load (Get Waypoints)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Planner mounted  â”‚
â”‚ user logged in   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useEffect: api.get("/")     â”‚
â”‚ - Sends auth token          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ HTTP GET
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: GET /waypoints     â”‚
â”‚ - No auth required          â”‚
â”‚ - Query all from MongoDB    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MongoDB: Find All Documents  â”‚
â”‚ Returns: Array of waypoints  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ HTTP Response 200
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: setWaypoints([])   â”‚
â”‚ - Update state with data     â”‚
â”‚ - Render all markers on map  â”‚
â”‚ - Populate sidebar list      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. View in Database

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Option 1: Browser API   â”‚ â”€â”€â–º GET /api/waypoints/debug/count
â”‚ Option 2: MongoDB CLI   â”‚ â”€â”€â–º mongosh > db.waypoints.find()
â”‚ Option 3: Compass GUI   â”‚ â”€â”€â–º Connect & browse
â”‚ Option 4: Console logs  â”‚ â”€â”€â–º F12 > Console tab
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ View waypoint documents      â”‚
â”‚ {                            â”‚
â”‚   _id: "507f1...",          â”‚
â”‚   lat: 18.6517,             â”‚
â”‚   lng: 73.7615,             â”‚
â”‚   order: 1,                 â”‚
â”‚   createdAt: Date(...)      â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## User Interaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER JOURNEY                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  1. Login Page                                          â”‚
â”‚     â””â”€â–º Firebase Auth                                  â”‚
â”‚         â””â”€â–º Get ID Token                               â”‚
â”‚                                                         â”‚
â”‚  2. Planner Page                                        â”‚
â”‚     â””â”€â–º Load Map                                       â”‚
â”‚         â””â”€â–º Load existing waypoints                    â”‚
â”‚             â””â”€â–º Render markers                         â”‚
â”‚                                                         â”‚
â”‚  3. Add Waypoint (Click Map)                           â”‚
â”‚     â””â”€â–º Place marker                                   â”‚
â”‚         â””â”€â–º Save to database                           â”‚
â”‚             â””â”€â–º Show success message                   â”‚
â”‚                 â””â”€â–º Persist on map                     â”‚
â”‚                                                         â”‚
â”‚  4. Manage Waypoints                                   â”‚
â”‚     â””â”€â–º View list in sidebar                          â”‚
â”‚         â””â”€â–º See in database (MongoDB Compass)         â”‚
â”‚             â””â”€â–º Clear route button                    â”‚
â”‚                                                         â”‚
â”‚  5. Refresh Page                                       â”‚
â”‚     â””â”€â–º Waypoints persist from database              â”‚
â”‚         â””â”€â–º Re-render automatically                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Management

### Frontend State
```javascript
{
  user: { uid, email, ... },           // From Firebase Auth
  waypoints: [                          // From MongoDB
    { _id, lat, lng, order, createdAt },
    { _id, lat, lng, order, createdAt }
  ],
  userPosition: { lat, lng },          // From geolocation
  roverPosition: { lat, lng },         // From /rover/gps
  statusMessage: "âœ… Waypoint saved",  // For UI feedback
  isSaving: false                      // For loading state
}
```

### Database Schema
```javascript
waypoint = {
  _id: ObjectId,
  lat: Number(-90 to 90),
  lng: Number(-180 to 180),
  order: Number,
  createdAt: Date
}
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Error Occurs                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚
â”‚  âŒ Not Logged In            â”‚
â”‚     â””â”€â–º Show alert           â”‚
â”‚                              â”‚
â”‚  âŒ Invalid Coordinates      â”‚
â”‚     â””â”€â–º Show error message   â”‚
â”‚         â””â”€â–º Log to console   â”‚
â”‚                              â”‚
â”‚  âŒ Network Error            â”‚
â”‚     â””â”€â–º Catch in .catch()    â”‚
â”‚         â””â”€â–º Show status      â”‚
â”‚                              â”‚
â”‚  âŒ Database Error           â”‚
â”‚     â””â”€â–º 500 response         â”‚
â”‚         â””â”€â–º Backend logs     â”‚
â”‚                              â”‚
â”‚  âŒ Auth Token Invalid       â”‚
â”‚     â””â”€â–º 401 response         â”‚
â”‚         â””â”€â–º Suggest re-login â”‚
â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Hierarchy

```
App
â”œâ”€â”€ Navbar
â”œâ”€â”€ AuthContext.Provider
â”‚   â””â”€â”€ Routes
â”‚       â”œâ”€â”€ Home
â”‚       â”œâ”€â”€ Login
â”‚       â”œâ”€â”€ Signup
â”‚       â””â”€â”€ Planner
â”‚           â”œâ”€â”€ MapContainer
â”‚           â”‚   â”œâ”€â”€ TileLayer (OpenStreetMap)
â”‚           â”‚   â””â”€â”€ MapView
â”‚           â”‚       â”œâ”€â”€ RecenterMap
â”‚           â”‚       â”œâ”€â”€ MapResizer
â”‚           â”‚       â”œâ”€â”€ Marker (userPosition)
â”‚           â”‚       â”œâ”€â”€ Circle (10m radius)
â”‚           â”‚       â”œâ”€â”€ Marker (roverPosition)
â”‚           â”‚       â”œâ”€â”€ Marker[] (waypoints)
â”‚           â”‚       â””â”€â”€ Polyline (route line)
â”‚           â”‚
â”‚           â””â”€â”€ Sidebar
â”‚               â”œâ”€â”€ Login status
â”‚               â”œâ”€â”€ Status message
â”‚               â”œâ”€â”€ Clear Route button
â”‚               â””â”€â”€ Waypoint list
```

---

## Database Persistence

```
Session 1           Session 2           Session 3
â”œâ”€ Click map   â”€â”€â–º Database â—„â”€â”€â”€â”€ New browser
â”œâ”€ Save WP1    â”€â”€â–º {WP1}   â”€â”€â”€â”€â”€â”€â–º Auto-load WP1
â”œâ”€ Save WP2    â”€â”€â–º {WP1,WP2}       âœ… Still there!
â””â”€ Refresh    â”€â”€â–º {WP1,WP2} â—„â”€â”€â”€â”€ Persist across
                               sessions
```

---

## Validation Layers

```
Frontend              Backend           Database
â”œâ”€ User logged in?    â”œâ”€ Auth token?     â”œâ”€ Schema valid?
â”œâ”€ Valid coords?      â”œâ”€ lat/lng present?â”‚
â”œâ”€ Numbers?           â”œâ”€ lat in range?   â”‚
â””â”€ Not NaN?           â”œâ”€ lng in range?   â”‚
                      â””â”€ Duplicate?      â””â”€ Unique ID
```

---

This architecture ensures:
- âœ… Real-time UI updates
- âœ… Persistent data storage
- âœ… Secure authentication
- âœ… Robust error handling
- âœ… Scalable design
